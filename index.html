<script>
    // --- State Variables ---
    let currentLayout = 1; // Default layout for posts page (1 = List, 2 = Grid)
    let currentPage = 'home'; // Tracks the current page shown
    
    // --- DOM Element References ---
    const contentArea = document.getElementById('content-area');
    const layout1Btn = document.getElementById('layout-1-btn');
    const layout2Btn = document.getElementById('layout-2-btn');
    const layoutName = document.getElementById('current-layout-name');
    const mainTitle = document.getElementById('main-title');
    const iconLayout1 = document.getElementById('icon-layout-1');
    const iconLayout2 = document.getElementById('icon-layout-2');
    const layoutSwitcherContainer = document.getElementById('layout-switcher-container');
    const sidebar = document.getElementById('sidebar');
    const sidebarContent = document.getElementById('sidebar-content');
    const toggleIcon = document.getElementById('toggle-icon');
    const mainContent = document.getElementById('main-content');


    // --- Mock Data: ARTIFACTS (POSTS) ---
    const posts = [
        { id: 1, type: 'essay', title: "The Ethics of Wetware: Building Better Nerves or Better People?", date: "Nov 9, 2025", summary: "A deep dive into the moral implications of neural interface technology and transhumanism, inspired by a late-night coding session.", tags: ["Technology", "Implants", "Ethics"], icon: `<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path></svg>`, 
            fullContent: "This essay explores the boundary between therapeutic use and human augmentation. If we can cure paralysis with neural links, what ethical framework guides the use of those same links to enhance memory or cognitive speed? The core conflict lies in equality: who gets access to \"better people\" technology, and what does it do to the concept of natural human variation? The consensus needs to be built on accessibility and non-discrimination, ensuring that technology serves all, not just the privileged few. The fear isn't in the tech itself, but in the social stratification it might accelerate. Wetware must improve lives, not just market share."
        },
        { id: 2, type: 'thought', title: "Why are frogs the ultimate minimalist architecture?", date: "Nov 7, 2025", summary: "Shower thought: Amphibians, particularly the wood frog, represent a perfect, chill design philosophy. Low-profile, high-impact.", tags: ["Frogs", "Muji", "Chill"], icon: `<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 19c-1.33-1.33-3.33-2.67-6-2.67S8.33 17.67 7 19c-2.67-2.67-3-7.33 0-11s7-4 10 0 2 8.33 0 11z"></path></svg>`,
            fullContent: "Consider the wood frog. It survives by freezing solid, then thawing. This is pure, low-maintenance design. No excessive heating systems, no complex insulation. It's the ultimate 'less is more' approach. We, as developers and thinkers, often over-engineer solutions. The frog is a reminder that the most elegant solution is often the most simple, adaptable, and resilient. My focus on Muji and simple aesthetics is directly inspired by this biological minimalism. Design should disappear and allow function to shine."
        },
        { id: 3, type: 'essay', title: "The Neomorphic Revolution: Making Surgical Suites Feel Less Terrifying", date: "Nov 5, 2025", summary: "Exploring how soft UI design (neomorphism) can translate into physical hospital design to reduce patient anxiety and improve surgical focus. It's 'hospital room core' theory.", tags: ["Surgery", "Design", "Aesthetics"], icon: `<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>`,
            fullContent: "Hospital rooms, especially surgical suites, are inherently stressful due to the harsh, functional design. Neomorphism, with its soft shadows, rounded corners, and gentle lighting, is an attempt to make digital interfaces feel more like physical, tactile objects. Applying this 'soft design' principle to surgical room architectureâ€”using diffused lighting, non-reflective surfaces, and subtle, natural color palettesâ€”could drastically lower patient stress and potentially improve focus for the surgical team. It's an exploration of how emotional comfort impacts high-stakes human performance."
        },
        { id: 4, type: 'thought', title: "Matcha is just a bio-sensor in a cup.", date: "Nov 3, 2025", summary: "The ritualistic preparation of matcha is a self-administered calibration test for my focus and patience. Spontaneous realization while waiting for the kettle.", tags: ["Matcha", "Spontaneous", "Chill"], icon: `<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8h1a4 4 0 0 1 0 8h-1"></path><path d="M10 21V3a4 4 0 0 0-4 4v10a4 4 0 0 0 4 4z"></path><path d="M13 17h6"></path><path d="M13 11h6"></path></svg>`,
            fullContent: "The entire processâ€”heating the water, sifting the powder, the measured whiskingâ€”demands attention. If my hand shakes too much, or if I rush the process, the matcha is clumpy and bitter. Therefore, the perfect cup of matcha is proof of my present focus. It's a quick, self-administered test of my mental state before a long coding session or a demanding study period. It's the ultimate 'chill' biofeedback mechanism, linking my state of mind to a perfect, soothing green beverage."
        },
    ];
    
    // --- Mock Data: SPOTLIGHTS ---
    const spotlights = [
        { id: 1, type: 'artist', title: "Artist Spotlight: The Lo-Fi King", date: "Nov 15, 2025", summary: "Exploring the chill beats and creative process of our monthly featured artist, perfect for coding sessions or just relaxing.", tags: ["Music", "Chill", "Lo-Fi"], icon: `<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 18l-6-5.8c-2-2-4-2.8-6-2.4a6 6 0 1 0 4 11.2V12"></path><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line></svg>`,
            fullContent: "The Lo-Fi King, known simply as 'Bambu,' masters the art of ambient noise and forgotten samples. His music is the auditory equivalent of this blog's aesthetic: calming, unobtrusive, and deeply structured. We analyze his use of field recordings (rain on tin) and subtle jazz chords to create an immersive, focused sonic environment. Bambu proves that productivity doesn't require high-tempo noise; sometimes, the best fuel for thought is simply a gentle, recurring loop. His commitment to pure, functional music is a mirror to Muji's design philosophy."
        },
        { id: 2, type: 'philosopher', title: "Philosopher: The Stoic Teen", date: "Oct 28, 2025", summary: "A look into how ancient Stoicism can help manage modern school stress and overwhelming ambition. A true 'Focus Your Portal' topic.", tags: ["Philosophy", "Study", "Mental Health"], icon: `<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>`,
            fullContent: "Modern education and social media bombard us with uncontrollable variables. Stoicism, particularly the concept of the 'dichotomy of control' (focusing only on what you can change), is the ultimate mental implant for today's high-pressure environment. This spotlight looks at applying Marcus Aurelius's teachings not to imperial management, but to managing deadlines, test anxiety, and the fear of failure. It turns out that ancient wisdom is the best debugging tool for a chaotic young mind."
        },
        { id: 3, type: 'dev', title: "CS Dev: The Tailwind Minimalist", date: "Sep 1, 2025", summary: "Spotlighting a developer who builds incredibly complex apps using only single-file, minimalist setups. Inspired by Muji design principles.", tags: ["Code", "Design", "CSS"], icon: `<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>`,
            fullContent: "We showcase a developer who adheres to the 'single-file mandate,' proving that complex web applications don't need sprawling file structures. This minimalist approach, heavily reliant on utility-first frameworks like Tailwind CSS, mirrors the efficiency found in Raspberry Pi programming: maximum output with minimal overhead. It's a deep dive into component composition and CSS strategy that prioritizes readability, portability, and zero external dependenciesâ€”the ultimate clean code."
        },
    ];

    // --- Mock Data: PROJECT ---
    const projectsData = {
        title: "Project: Modular Frog Habitat Sensor",
        type: "Hardware",
        date: "Ongoing",
        icon: `<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>`,
        tags: ["Arduino", "Python", "Sensors"],
        fullContent: "The goal is to build a low-power, robust sensor package for monitoring a simulated wood frog habitat. **Current Phase:** Hardware assembly and initial Python logging script. The minimalistic circuit design aims for maximum battery life. Future plans include a remote web dashboard to view historical temperature and humidity data, mimicking the principles of Muji's simple, functional aesthetics in a technical build. The biggest challenge is isolating the DHT22 sensor from ambient electrical noise to ensure data reliability."
    };

    // --- Mock Data: ABOUT ME ---
    const aboutData = {
        title: "About Me: The Full Manifesto",
        type: "Manifesto",
        date: "Forever",
        icon: `<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>`,
        tags: ["Nostalgia", "Minimalism", "Overthinking"],
        fullContent: `Iâ€™m a deeply **nostalgic girlie** who loves clean lines and quiet contemplation (hence the Muji obsession). My biggest conflict is being **ambitious as hell but a bit lazy**â€”I want to solve big problems, but I need the perfect, chill environment to start. This leads to a lot of **overthinking**, but that usually leads to a surprising connection between, say, the color of **matcha** and the soothing green of a surgical light.

**The Matcha Principle:** Matcha is the perfect blend of ritual and energy. It represents the focused, clean energy I want to bring to implants and surgery. Clean fuel for precise thinking.

**The Frog & Bamboo Connection:** Frogs are spontaneous and minimal. Bamboo is strong, flexible, and essential to Chinese culture. Together, they symbolize my approach: being spontaneous (like jumping to a new idea) but rooted in strength and structure.

I believe technology should be an elegant extension of human capability, not a distraction. That's the **Irreverent Implant** philosophyâ€”serious technology, chill aesthetic.`
    };
    // --- END MOCK DATA ---


    // --- Sidebar Collapse Logic (Updated for stability) ---
    function toggleSidebar() {
        // Only execute on desktop/tablet views (md breakpoint or wider)
        if (window.innerWidth < 768) return;

        // Toggle a simple state class that we use for button positioning/icon
        const isCollapsed = sidebar.classList.toggle('is-collapsed-desktop');
        
        // 1. Sidebar width and shape
        sidebar.classList.toggle('md:w-1/4');
        sidebar.classList.toggle('md:w-16'); 
        sidebar.classList.toggle('rounded-3xl');
        sidebar.classList.toggle('rounded-full');
        sidebar.classList.toggle('p-6');
        sidebar.classList.toggle('p-2'); // Small padding for collapsed state

        // 2. Main content width
        mainContent.classList.toggle('md:w-3/4');
        mainContent.classList.toggle('md:w-full');

        // 3. Inner content visibility 
        // Add/remove pointer-events-none to prevent clicking invisible links
        sidebarContent.classList.toggle('opacity-100');
        sidebarContent.classList.toggle('opacity-0');
        sidebarContent.classList.toggle('pointer-events-none'); 

        // 4. Button/Icon Aesthetics
        const toggleBtn = document.getElementById('sidebar-toggle-btn');
        if (toggleIcon && toggleBtn) {
            if (isCollapsed) {
                // COLLAPSED State: Show Hamburger, center the button, make it full circle
                toggleIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>`;
                
                // Change button shape/position to fill the collapsed circle
                toggleBtn.classList.remove('top-4', 'right-4', 'p-2', 'rounded-full');
                toggleBtn.classList.add('inset-0', 'm-auto', 'w-full', 'h-full', 'rounded-full', 'p-0');
                // Override the neuomorphic shadow when fully collapsed into a simple circle
                toggleBtn.style.boxShadow = 'none'; 
                toggleBtn.style.backgroundColor = 'transparent';

            } else {
                // EXPANDED State: Show chevron, button in the corner, regular size
                toggleIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"></path>`;
                
                // Reset button appearance
                toggleBtn.classList.add('top-4', 'right-4', 'p-2', 'rounded-full');
                toggleBtn.classList.remove('inset-0', 'm-auto', 'w-full', 'h-full', 'p-0');
                toggleBtn.style.boxShadow = ''; // Restore neuo-button box-shadow
                toggleBtn.style.backgroundColor = ''; // Restore neuo-button background
            }
        }
    }


    // --- Content Rendering Functions ---

    function renderHome() {
        mainTitle.textContent = "Circles";
        setActiveNav('home');
        contentArea.innerHTML = `
            <div class="space-y-8">
                
                <div class="grid grid-cols-3 gap-4">
                    <div class="neuo-card rounded-2xl aspect-square flex items-center justify-center text-center p-4 bg-matcha-green/30">
                        <p class="text-sm font-semibold text-matcha-green">Matcha/Chill Image</p>
                        <img src="https://placehold.co/150x150/A7C49D/FFFFFF?text=Matcha" class="absolute w-full h-full object-cover opacity-0" onerror="this.onerror=null; this.style.opacity='1'; this.style.position='static';" alt="Matcha Image Placeholder">
                    </div>
                    <div class="neuo-card rounded-2xl aspect-square flex items-center justify-center text-center p-4 bg-wood-accent/30">
                        <p class="text-sm font-semibold text-wood-accent">Frog/Wood Image</p>
                        <img src="https://placehold.co/150x150/B8B3A8/FFFFFF?text=Frog" class="absolute w-full h-full object-cover opacity-0" onerror="this.onerror=null; this.style.opacity='1'; this.style.position='static';" alt="Frog Image Placeholder">
                    </div>
                    <div class="neuo-card rounded-2xl aspect-square flex items-center justify-center text-center p-4 bg-gray-300/30">
                        <p class="text-sm font-semibold text-gray-700">Implant/Pi Image</p>
                        <img src="https://placehold.co/150x150/CCCCCC/666666?text=Implant" class="absolute w-full h-full object-cover opacity-0" onerror="this.onerror=null; this.style.opacity='1'; this.style.position='static';" alt="Implant Image Placeholder">
                    </div>
                </div>

                <article class="p-8 rounded-2xl neuo-card">
                    <h3 class="text-2xl font-bold mb-4 text-bamboo-accent">The Thesis Statement</h3>
                    <p class="text-lg text-gray-700 leading-relaxed">
                        Welcome to my digital sanctuary, a space for to documenting all of my thoughts, plans, and projects. Right now, this blog is in the single-celled organism(the protoplasm) phase. It is a basic, but constantly evolving collection of half-baked ideas, future plans, and the step-by-step documentation of ongoing projects.
                    </p>
                    <p class="text-lg text-gray-700 leading-relaxed mt-4">
                        Consider this the very beginning.
                    </p>
                </article>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="p-6 rounded-2xl neuo-card text-center cursor-pointer hover:bg-matcha-green/10" onclick="navigateTo('posts')">
                        <h4 class="text-xl font-semibold text-matcha-green">See the Artifacts</h4>
                        <p class="text-sm text-gray-500 mt-1">From long essays to spontaneous sparks.</p>
                    </div>
                    <div class="p-6 rounded-2xl neuo-card text-center cursor-pointer hover:bg-matcha-green/10" onclick="navigateTo('projects')">
                        <h4 class="text-xl font-semibold text-matcha-green">Check the Projects</h4>
                        <p class="text-sm text-gray-500 mt-1">From game dev bugs to Arduino wire-ups.</p>
                    </div>
                    <div class="p-6 rounded-2xl neuo-card text-center cursor-pointer hover:bg-matcha-green/10" onclick="navigateTo('about')">
                        <h4 class="text-xl font-semibold text-matcha-green">My Personal Code</h4>
                        <p class="text-sm text-gray-500 mt-1">Why matcha, why frogs, and why implants.</p>
                    </div>
                </div>
            </div>
        `;
    }
    
    // Renders the main Projects page
    function renderProjects() {
        mainTitle.textContent = "Project Portfolio: Bugs & Raspberry Pi";
        setActiveNav('projects');
        contentArea.innerHTML = `
            <div class="space-y-6">
                <p class="text-gray-700 leading-relaxed p-6 rounded-2xl neuo-card">
                    I used to be obsessed with game development, but now I'm transitioning that energy into hardware projects. The joy of solving a complex bug (a software implant) is similar to wiring an Arduino for a clean, efficient function (a hardware implant).
                </p>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <article onclick="renderDetail(projectsData, 'projects')" class="p-6 rounded-2xl neuo-card cursor-pointer hover:border-matcha-green border-2 border-transparent transition duration-200">
                        <h3 class="text-xl font-bold mb-2 text-bamboo-accent">Project: Modular Frog Habitat Sensor</h3>
                        <p class="text-sm text-gray-600 mb-3">**Tech:** Arduino Uno, DHT22 sensor, Python logging.</p>
                        <p class="text-gray-700">A physical computation project inspired by my love for frogs and clean design. It logs temperature and humidity data for a simulated wood frog habitat, focusing on minimalistic circuit design and reliable data transmission.</p>
                    </article>
                    <article class="p-6 rounded-2xl neuo-card">
                        <h3 class="text-xl font-bold mb-2 text-bamboo-accent">Retrospective: Game Dev to Hardware</h3>
                        <p class="text-sm text-gray-600 mb-3">**Theme:** Efficiency in Code vs. Efficiency in Circuitry.</p>
                        <p class="text-gray-700">An analysis of how my experience debugging and optimizing game physics code directly applies to finding the most efficient, low-power solution for a Raspberry Pi application, highlighting the universal principles of engineering.</p>
                    </article>
                </div>
            </div>
        `;
    }
    
    // Renders the main Spotlights page
    function renderSpotlights() {
        mainTitle.textContent = "Spotlights: Wiki FYP (For Your Portal)";
        setActiveNav('spotlights');
        contentArea.innerHTML = `
            <div class="space-y-6">
                <p class="text-gray-700 leading-relaxed p-6 rounded-2xl neuo-card">
                    This is where I focus my energy on one topic a monthâ€”a musician, a developer, a philosopher, or a random piece of tech. Itâ€™s like a personalized 'For You Page' but for the things that genuinely catch my attention and deserve a deep dive.
                </p>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    ${spotlights.map((item, i) => `
                        <article onclick="renderDetail(spotlights[${i}], 'spotlights')" class="p-6 rounded-2xl neuo-card cursor-pointer hover:border-matcha-green border-2 border-transparent transition duration-200">
                            <h3 class="text-xl font-bold mb-2 text-bamboo-accent flex items-center">
                                ${item.icon || ''}
                                ${item.title}
                            </h3>
                            <p class="text-sm text-gray-600 mb-3">**Category:** ${item.type.charAt(0).toUpperCase() + item.type.slice(1)} | ${item.date}</p>
                            <p class="text-gray-700">${item.summary}</p>
                        </article>
                    `).join('')}
                </div>
            </div>
        `;
    }

    // Renders the main About Me page
    function renderAbout() {
        mainTitle.textContent = "About Me: Matcha, Muji, and My Manifesto";
        setActiveNav('about');
        contentArea.innerHTML = `
            <div class="space-y-6">
                <p class="text-lg text-gray-700 leading-relaxed p-6 rounded-2xl neuo-card">
                    Iâ€™m a deeply **nostalgic girlie** who loves clean lines and quiet contemplation (hence the Muji obsession). My biggest conflict is being **ambitious as hell but a bit lazy**â€”I want to solve big problems, but I need the perfect, chill environment to start. This leads to a lot of **overthinking**, but that usually leads to a surprising connection between, say, the color of **matcha** and the soothing green of a surgical light.
                </p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="p-6 rounded-2xl neuo-card">
                        <h4 class="text-xl font-bold mb-2 text-matcha-green">The Matcha Principle</h4>
                        <p class="text-sm text-gray-700">Matcha is the perfect blend of ritual and energy. It represents the focused, clean energy I want to bring to **implants and surgery**. Clean fuel for precise thinking.</p>
                    </div>
                    <div class="p-6 rounded-2xl neuo-card">
                        <h4 class="text-xl font-bold mb-2 text-bamboo-accent">The Frog & Bamboo Connection</h4>
                        <p class="text-sm text-gray-700">Frogs are spontaneous and minimal. Bamboo is strong, flexible, and essential to Chinese culture. Together, they symbolize my approach: being **spontaneous** (like jumping to a new idea) but rooted in **strength and structure**.</p>
                    </div>
                </div>
                <div class="p-6 rounded-2xl neuo-card text-center cursor-pointer hover:bg-matcha-green/10" onclick="renderDetail(aboutData, 'about')">
                    <h4 class="text-xl font-semibold text-matcha-green">Read The Full Manifesto ðŸš€</h4>
                    <p class="text-sm text-gray-500 mt-1">A comprehensive look at my inspirations and philosophy.</p>
                </div>
            </div>
        `;
    }
    
    // --- DETAIL VIEW RENDERER (Universal Function) ---
    function renderDetail(item, previousPage) {
        mainTitle.textContent = item.title;
        
        // Determine the correct function to call when the back button is clicked
        let backButtonHandler;
        if (previousPage === 'posts') {
            // Posts need to return to the list and restore the current layout (1 or 2)
            backButtonHandler = `MapsTo('${previousPage}'); switchLayout(${currentLayout})`;
        } else {
            // All other pages (spotlights, projects, about) just return to their list view
            backButtonHandler = `MapsTo('${previousPage}')`;
        }

        contentArea.innerHTML = `
            <div class="neuo-card p-8 rounded-2xl space-y-6">
                <div class="flex items-center justify-between border-b pb-4 mb-4 border-gray-200">
                    <div class="flex items-center text-lg font-semibold text-matcha-green">
                        ${item.icon || ''}
                        ${item.type.charAt(0).toUpperCase() + item.type.slice(1)}
                    </div>
                    <span class="text-sm text-gray-500">${item.date || ''}</span>
                </div>

                <article class="text-gray-700 leading-relaxed">
                    <p class="text-base leading-relaxed whitespace-pre-wrap">${item.fullContent}</p>
                    <div class="flex flex-wrap gap-2 pt-4 border-t border-gray-200 mt-6">
                        <span class="text-sm font-semibold text-gray-700">Tags:</span>
                        ${item.tags.map(tag => `<span class="text-xs font-medium px-3 py-1 rounded-full bg-wood-accent/10 text-wood-accent">${tag}</span>`).join(' ')}
                    </div>
                </article>

                <button onclick="${backButtonHandler}" class="neuo-button mt-6 p-3 rounded-xl inline-flex items-center text-sm font-medium hover:text-bamboo-accent">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                    </svg>
                    Back to List
                </button>
            </div>
        `;
    }

    // --- Layout 1: The Thinker's Desk (List/Essay View) for Posts ---
    function renderLayout1() {
        mainTitle.textContent = "The Thinker's Desk: Deep Artifacts (List View)";
        contentArea.innerHTML = posts.map((post, i) => `
            <article onclick="renderDetail(posts[${i}], 'posts')" class="p-6 mb-6 rounded-2xl neuo-card cursor-pointer hover:border-matcha-green border-2 border-transparent transition duration-200">
                <div class="flex items-center text-sm font-semibold mb-1 text-matcha-green">
                    ${post.icon || ''}
                    ${post.type.toUpperCase()}
                    <span class="text-gray-400 ml-auto">${post.date}</span>
                </div>
                <h3 class="text-xl font-bold mb-2 hover:text-bamboo-accent transition">${post.title}</h3>
                <p class="text-gray-600 mb-3">${post.summary}</p>
                <div class="flex flex-wrap gap-2">
                    ${post.tags.map(tag => `<span class="text-xs font-medium px-3 py-1 rounded-full bg-wood-accent/10 text-wood-accent">${tag}</span>`).join('')}
                </div>
            </article>
        `).join(''); 
    }

    // --- Layout 2: The Implant View (Grid/Component View) for Posts ---
    function renderLayout2() {
        mainTitle.textContent = "The Implant View: Spontaneous Components (Grid)";
        contentArea.innerHTML = `<div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
            ${posts.map((post, i) => `
                <article onclick="renderDetail(posts[${i}], 'posts')" class="p-5 rounded-2xl neuo-card cursor-pointer hover:border-matcha-green border-2 border-transparent transition duration-200">
                    <div class="flex items-start mb-2">
                        <div class="p-2 rounded-full bg-matcha-green/20 text-matcha-green">
                            ${post.icon || ''}
                        </div>
                        <span class="text-xs ml-auto text-gray-500">${post.date}</span>
                    </div>
                    <h3 class="text-lg font-bold mb-2">${post.title}</h3>
                    <p class="text-sm text-gray-600 mb-3">${post.summary.substring(0, 70)}...</p>
                    <div class="text-xs text-wood-accent font-medium">${post.tags.join(', ')}</div>
                </article>
            `).join('')}
        </div>`;
    }

    // --- Layout Switching Logic (Toggles between List and Grid view for Posts) ---
    function switchLayout(layout) {
        currentLayout = layout;
        
        // 1. Reset button styles for both buttons
        layout1Btn.classList.remove('neuo-active-inner');
        layout2Btn.classList.remove('neuo-active-inner');
        iconLayout1.classList.remove('text-matcha-green');
        iconLayout2.classList.remove('text-matcha-green');
        iconLayout1.classList.add('text-gray-400');
        iconLayout2.classList.add('text-gray-400');

        // 2. Apply active styles and call the correct render function
        if (layout === 1) {
            renderLayout1();
            layout1Btn.classList.add('neuo-active-inner');
            iconLayout1.classList.add('text-matcha-green');
            iconLayout1.classList.remove('text-gray-400');
            layoutName.textContent = "Desk View";
        } else { // layout === 2
            renderLayout2();
            layout2Btn.classList.add('neuo-active-inner');
            iconLayout2.classList.add('text-matcha-green');
            iconLayout2.classList.remove('text-gray-400');
            layoutName.textContent = "Component View";
        }
    }

    // Neomorphic Active Class for Navigation (Makes the selected link look 'pressed in')
    function setActiveNav(pageId) {
        // Remove active class from all links first
        document.querySelectorAll('#main-nav a').forEach(a => {
            a.classList.remove('neuo-active-inner', 'text-matcha-green', 'font-semibold');
            a.classList.add('neuo-button'); // Ensure it has the default button style
        });
        // Add active class to the selected link
        const activeLink = document.getElementById(`nav-${pageId}`);
        if (activeLink) {
            activeLink.classList.remove('neuo-button');
            activeLink.classList.add('neuo-active-inner', 'text-matcha-green', 'font-semibold');
        }
    }

    // --- Primary Navigation Handler (The App Router) ---
    function navigateTo(page, event) {
        // Prevents the browser from navigating away (important for single-page apps)
        if (event) event.preventDefault();
        
        currentPage = page;
        setActiveNav(page); // Update the active navigation link style
        
        // Handle layout switcher visibility: only show on the 'posts' page
        const showLayoutSwitcher = page === 'posts';
        layoutSwitcherContainer.classList.toggle('hidden', !showLayoutSwitcher);

        contentArea.innerHTML = ''; // Clear the main content area before loading new content
        mainTitle.textContent = 'Loading...'; 

        switch (page) {
            case 'home':
                renderHome();
                break;
            case 'posts':
                // Renders the posts using the currently selected layout (1 or 2)
                switchLayout(currentLayout); 
                break;
            case 'projects':
                renderProjects();
                break;
            case 'spotlights':
                renderSpotlights();
                break;
            case 'about':
                renderAbout();
                break;
            default:
                renderHome();
        }
    }

    // --- Theme Logic ---

    const THEMES = {
        '0': { name: 'Light Mode', class: '' },
        '1': { name: 'Sepia Mode', class: 'sepia-mode' },
        '2': { name: 'Dark Mode', class: 'dark-mode' }
    };

    function updateTheme(value) {
        const body = document.body;
        const themeData = THEMES[value];
        const themeNameElement = document.getElementById('current-theme-name');
        const lightIcon = document.getElementById('light-icon');
        const darkIcon = document.getElementById('dark-icon');

        body.classList.remove('sepia-mode', 'dark-mode');
        if (themeData.class) {
            body.classList.add(themeData.class);
        }

        themeNameElement.textContent = themeData.name;
        
        lightIcon.classList.remove('text-matcha-green');
        darkIcon.classList.remove('text-matcha-green');

        if (value == 0) {
            lightIcon.classList.add('text-matcha-green');
        } else if (value == 2) {
            darkIcon.classList.add('text-matcha-green');
        }

        localStorage.setItem('themeValue', value);
    }
    
    // --- Initialization (BUG FIX: Default to Light Mode) ---

    document.addEventListener('DOMContentLoaded', () => {
        const themeSlider = document.getElementById('theme-slider');
        
        // FIX: Hard set initial value to '0' (Light Mode) to override system preference
        const initialValue = '0'; 

        themeSlider.value = initialValue;
        updateTheme(initialValue); // Apply the initial theme

        // Initialize navigation (This loads the home content)
        navigateTo('home', { preventDefault: () => {} });
    });
</script>
